import{i as P,h as N,a as _,j as e,R as v}from"./index-DRLOKyBb.js";import{Q as b,u as y}from"./useBaseQuery-B8Kr4lM1.js";import{D as w}from"./DescriptionBox-Dj_QFhWr.js";var I=class extends b{constructor(t,i){super(t,i)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(t){super.setOptions({...t,behavior:P()})}getOptimisticResult(t){return t.behavior=P(),super.getOptimisticResult(t)}fetchNextPage(t){return this.fetch({...t,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(t){return this.fetch({...t,meta:{fetchMore:{direction:"backward"}}})}createResult(t,i){var f,j;const{state:s}=t,r=super.createResult(t,i),{isFetching:c,isRefetching:a,isError:o,isRefetchError:d}=r,h=(j=(f=s.fetchMeta)==null?void 0:f.fetchMore)==null?void 0:j.direction,l=o&&h==="forward",g=c&&h==="forward",u=o&&h==="backward",m=c&&h==="backward";return{...r,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:_(i,s.data),hasPreviousPage:N(i,s.data),isFetchNextPageError:l,isFetchingNextPage:g,isFetchPreviousPageError:u,isFetchingPreviousPage:m,isRefetchError:d&&!l&&!u,isRefetching:a&&!g&&!m}}};function C(t,i){return y(t,I)}const x=45,p=10,T=async({pageParam:t=1})=>{console.log(`Fetching infinite data - pageParam: ${t}`),await new Promise(a=>setTimeout(a,750));const i=(t-1)*p,s=i+p,r=Array.from({length:x},(a,o)=>`Infinite Item ${o+1}`).slice(i,s),c=s<x?t+1:null;return{items:r,nextPage:c,totalItems:x}},F="_container_n3ahj_1",R="_descriptionColumn_n3ahj_23",M="_exampleColumn_n3ahj_33",E="_heading_n3ahj_49",L="_itemList_n3ahj_63",k="_item_n3ahj_63",Q="_loadMoreContainer_n3ahj_91",D="_button_n3ahj_107",O="_loadingText_n3ahj_153",q="_errorText_n3ahj_169",n={container:F,descriptionColumn:R,exampleColumn:M,heading:E,itemList:L,item:k,loadMoreContainer:Q,button:D,loadingText:O,errorText:q},K=()=>{const{data:t,error:i,fetchNextPage:s,hasNextPage:r,isFetching:c,isFetchingNextPage:a,status:o}=C({queryKey:["infiniteData"],queryFn:T,initialPageParam:1,getNextPageParam:d=>d.nextPage});return e.jsxs("div",{className:n.container,children:[e.jsx("div",{className:n.descriptionColumn,children:e.jsxs(w,{title:"Infinite Loading with useInfiniteQuery",children:[e.jsxs("p",{children:["This example uses ",e.jsx("code",{children:"useInfiniteQuery"}),' for loading data in chunks, suitable for "load more" or infinite scroll interfaces.']}),e.jsxs("ul",{children:[e.jsxs("li",{children:["The API function (",e.jsx("code",{children:"fetchInfiniteData"}),") receives a ",e.jsx("code",{children:"pageParam"})," and is expected to return the data items along with information about the ",e.jsx("em",{children:"next"})," page (",e.jsx("code",{children:"nextPage"})," in this case)."]}),e.jsxs("li",{children:[e.jsx("code",{children:"initialPageParam: 1"})," tells Tanstack Query what parameter to use for the very first fetch."]}),e.jsxs("li",{children:[e.jsx("code",{children:"getNextPageParam"})," is a function that receives the ",e.jsx("em",{children:"last fetched page"})," and determines the parameter for the ",e.jsx("em",{children:"next"})," page request. Here, it simply returns the"," ",e.jsx("code",{children:"nextPage"})," value from our API response. It returns ",e.jsx("code",{children:"undefined"})," or"," ",e.jsx("code",{children:"null"})," when there are no more pages."]}),e.jsxs("li",{children:["The fetched data is accumulated in"," ",e.jsx("code",{children:"data.pages"}),", an array where each element corresponds to the data returned for one page fetch. We need to map over this array to render all items."]}),e.jsxs("li",{children:[e.jsx("code",{children:"fetchNextPage()"})," is called to trigger loading the next chunk of data."]}),e.jsxs("li",{children:[e.jsx("code",{children:"hasNextPage"})," is a boolean derived from the return value of ",e.jsx("code",{children:"getNextPageParam"}),", indicating if more data can be loaded."]}),e.jsxs("li",{children:[e.jsx("code",{children:"isFetchingNextPage"})," is true specifically when the ",e.jsx("em",{children:"next"})," page is being fetched via"," ",e.jsx("code",{children:"fetchNextPage"}),"."]})]})]})}),e.jsxs("div",{className:n.exampleColumn,children:[e.jsx("h1",{className:n.heading,children:"Infinite Loading Example"}),o==="pending"?e.jsx("p",{className:n.loadingText,children:"Loading initial data..."}):o==="error"?e.jsxs("p",{className:n.errorText,children:["Error:"," ",i instanceof Error?i.message:"Unknown error"]}):e.jsxs(e.Fragment,{children:[e.jsx("ul",{className:n.itemList,children:t&&t.pages.map((d,h)=>e.jsxs(v.Fragment,{children:[" ",d.items.map(l=>e.jsx("li",{className:n.item,children:l},l))]},h))}),e.jsx("div",{className:n.loadMoreContainer,children:e.jsx("button",{onClick:()=>s(),disabled:!r||a,className:n.button,children:a?"Loading more...":r?"Load More":"Nothing more to load"})}),c&&!a&&e.jsx("div",{className:n.loadingText,children:"Fetching in background..."})]})]})]})};export{K as InfiniteLoadingExample};
